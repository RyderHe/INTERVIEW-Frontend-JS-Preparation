# 7.2 Promise

[ğŸ¦Review Call back hell and Promise](../6.-yi-bu-3/6.4-callback-hell-he-promise.md)

## ä¸‰ç§çŠ¶æ€

1. pending
2. resolved æˆåŠŸ
3. rejected å¤±è´¥

ğŸ”· pending -&gt; resolved

ğŸ”· pending -&gt; rejected

ğŸ”· å˜åŒ–ä¸å¯é€†

## çŠ¶æ€çš„è¡¨ç°å’Œå˜åŒ–

* çŠ¶æ€çš„è¡¨ç°
  * pending çŠ¶æ€: ä¸ä¼šè§¦å‘thenå’Œcatch
  * resolved çŠ¶æ€: ä¼šè§¦å‘åç»­çš„thenå›è°ƒå‡½æ•°
  * rejected çŠ¶æ€ï¼šä¼šè§¦å‘åç»­çš„catchå›è°ƒå‡½æ•°

```javascript
const p1 = Promise.resolve(100);
console.log(p1); // resolved

p1.then(data => {
    console.log(data);
}).catch(err => { // won't trigger
    console.log("error1", err);
}); 
// 100
```

```javascript
const p2 = Promise.reject("err2");
console.log(p2); // rejected

p2.then(data => { // won't trigger
    console.log(data);
}).catch(err => { 
    console.log(err);
});
// err2
```

* çŠ¶æ€çš„å˜åŒ–

```javascript
const p1 = new Promise((resolve, reject) => {

});
console.log(p1); // Promise{<pending>}
```

```javascript
const p2 = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve();
    });
});
console.log(p2); // Promise{<pending>}
setTimeout(() => console.log("setTimeout: ", p2)); // resolved
```

æ‰“å°å‡ºpendingçŠ¶æ€æ˜¯å› ä¸ºå®šä¹‰p2ä¹‹åç«‹åˆ»å»æ‰“å°p2, æ­¤æ—¶resolve\(\)è¿˜æ²¡æœ‰è¢«æ‰§è¡Œã€‚

```javascript
const p3 = new Promise((resolve, reject) => {
    setTimeout(() => {
        reject();
    });
});
console.log(p3); // Promise{<pending>}
setTimeout(() => console.log("setTimeout: ", p3)); // rejected
```

## then å’Œ catch å¯¹çŠ¶æ€çš„å½±å“

* thenæ­£å¸¸è¿”å› resolvedï¼Œ é‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å›rejected

```javascript
const p1 = Promise.resolve().then(() => {
    return 100;
}) // p1 æœ€ç»ˆç»“æœ resolved
// resolved è§¦å‘åç»­ then å›è°ƒ
p1.then(() => {
    console.log("123"); // print 123
});

const p2 = Promise.resolve().then(() => {
    thorw new Error("then error 2");
}) // p2 æœ€ç»ˆç»“æœ rejected
// rejected è§¦å‘åç»­ catch å›è°ƒ
p2.then(() => {
    console.log("456"); // do not print
}).catch(err => {
    console.error("err100", err) // err100 then error 2
}); // catchå®Œ çŠ¶æ€ä¸º resolved
```

* catch æ­£å¸¸è¿”å› resolvedï¼Œ é‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å›rejected

```javascript
const p3 = Promise.rejected("my err").catch(err => {
    console.error(err)
}); // catchå®Œ æœ€ç»ˆç»“æœ resolved => è§¦å‘then å›è°ƒ

p3.then(() => {
    console.log("then100"); // then100
});

const p4 = Promise.rejected("my err").catch(err => {
    throw new Error("catch error");
}) // p4 æœ€ç»ˆç»“æœ rejected => è§¦å‘ catch å›è°ƒ

p4.then(() => {
    console.log("then200"); // do not print
}).catch(err => {
    console.log("some err"); // some err
}); // æœ€ç»ˆçŠ¶æ€ resolved
```



