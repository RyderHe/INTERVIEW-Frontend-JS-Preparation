# 7.1 event loop

ğŸ”· JS æ˜¯**å•çº¿ç¨‹**è¯­è¨€

ğŸ”· å¼‚æ­¥ \(setTimeout, ajax\) è¦ä½¿ç”¨**å›è°ƒ**æ¥å®ç°ï¼ŒåŸºäºevent loop

ğŸ”· DOMäº‹ä»¶ ä¹Ÿè¦ä½¿ç”¨**å›è°ƒ**æ¥å®ç°ï¼ŒåŸºäºevent loop

ğŸ”¶ **event loop** å°±æ˜¯å¼‚æ­¥å›è°ƒçš„å®ç°åŸç†

ğŸ”¶ JS å¦‚ä½•æ‰§è¡Œï¼Ÿ

* ä»å‰åˆ°åï¼Œä¸€è¡Œä¸€è¡Œæ‰§è¡Œ
* å¦‚æœæŸä¸€è¡Œæ‰§è¡ŒæŠ¥é”™ï¼Œåˆ™åœæ­¢ä¸‹é¢ä»£ç çš„æ‰§è¡Œ
* å…ˆæŠŠåŒæ­¥ä»£ç æ‰§è¡Œå®Œï¼Œå†æ‰§è¡Œå¼‚æ­¥

## event loop è¿‡ç¨‹

1. åŒæ­¥ä»£ç : ä¸€è¡Œä¸€è¡Œæ”¾åœ¨ call stack æ‰§è¡Œ
2. é‡åˆ°å¼‚æ­¥ï¼š
   * å…ˆ"è®°å½•"ä¸‹ï¼Œç­‰å¾…æ—¶æœº \(å®šæ—¶ï¼Œç½‘ç»œè¯·æ±‚\)
   * æ—¶æœºä¸€åˆ°ï¼Œç§»åŠ¨åˆ° callback queue
3. å¦‚æœ call stack ä¸ºç©º \(å³ åŒæ­¥ä»£ç æ‰§è¡Œå®Œ\), event loop å¼€å§‹å·¥ä½œ - è½®è¯¢æŸ¥æ‰¾ callback queueï¼š å¦‚æœ‰ åˆ™ç§»åŠ¨åˆ° call stack æ‰§è¡Œï¼›ç„¶åç»§ç»­è½®è¯¢æŸ¥æ‰¾ \(åƒæ°¸åŠ¨æœºä¸€æ ·\)

ä¸¾ä¾‹ï¼š

```javascript
console.log("hi");

setTimeout(function cb1(){
    console.log("callback1");
}, 5000);

console.log("bye"); // hi  bye  callback1
```

![eventloop&#x8FC7;&#x7A0B;1](../.gitbook/assets/eventloop1.png)

![eventloop&#x8FC7;&#x7A0B;2](../.gitbook/assets/eventloop2.png)

![eventloop&#x8FC7;&#x7A0B;3](../.gitbook/assets/eventloop3.png)

![eventloop&#x8FC7;&#x7A0B;4](../.gitbook/assets/eventloop4.png)

![eventloop&#x8FC7;&#x7A0B;5](../.gitbook/assets/eventloop5.png)

![eventloop&#x8FC7;&#x7A0B;6](../.gitbook/assets/eventloop6.png)

![eventloop&#x8FC7;&#x7A0B;7](../.gitbook/assets/eventloop7.png)

![eventloop&#x8FC7;&#x7A0B;8](../.gitbook/assets/eventloop7.png)

![event loop dom&#x6E32;&#x67D3;](../.gitbook/assets/eventloop-dom.png)

When 5s is done:

![eventloop&#x8FC7;&#x7A0B;9](../.gitbook/assets/eventloop9.png)

![eventloop&#x8FC7;&#x7A0B;10](../.gitbook/assets/eventloop10.png)

![eventloop&#x8FC7;&#x7A0B;11](../.gitbook/assets/eventloop11.png)

![eventloop&#x8FC7;&#x7A0B;12](../.gitbook/assets/eventloop12.png)

![eventloop&#x8FC7;&#x7A0B;13](../.gitbook/assets/eventloop13.png)

## DOMäº‹ä»¶ å’Œ event loop

```markup
<button id="btn"> SUBMIT </button>

<script>
console.log("hi");

$("#btn").click(function (e) {
    console.log("button click"); // æœ¬è´¨æ˜¯ å›è°ƒ(callback) 
                                 // å·®åˆ«åœ¨äºè§¦å‘æ—¶æœºä¸ä¸€æ ·
                                 // è¿™é‡Œæ˜¯ç”¨æˆ·ç‚¹å‡»åˆ™è§¦å‘
});

console.log("bye");
</script>
```

