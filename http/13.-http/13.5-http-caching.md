---
description: Caching
---

# 13.5 http ç¼“å­˜

{% hint style="info" %}
**HTTP caching** occurs when the browser stores local copies of web resources for faster retrieval the next time the resource is required.
{% endhint %}

## ä»€ä¹ˆæ˜¯ç¼“å­˜\(caching\)

Caching is a technique that stores a **copy** of a given resource and serves it back when requested. When a web cache has a requested resource in its store, it intercepts the request and returns its copy instead of re-downloading from the originating server. 

This achieves several goals: 

* it eases the load of the server that doesnâ€™t need to serve all clients itself
* it **improves performance** by being closer to the client, i.e., it takes less time to transmit the resource back. 

For a website, it is a major component in achieving high performance. On the other side, it has to be configured properly as not all resources stay identical forever: it is important to cache a resource only until it changes, not longer.

* é€šè¿‡ç¼“å­˜å‡å°‘ç½‘ç»œè¯·æ±‚çš„æ•°é‡ åŠ å¿«é¡µé¢æ¸²æŸ“

## å“ªäº›èµ„æºå¯ä»¥è¢«ç¼“å­˜?

* é™æ€èµ„æº \( js css img \)
* webpack hash ğŸ›© 

## http ç¼“å­˜ç­–ç•¥

### å¼ºåˆ¶ç¼“å­˜

{% hint style="info" %}
Cache-Control vs Expires
{% endhint %}

* **Cache-Control** \(åœ¨ response headers ä¸­\)
* eg: _Cache-Control: max-age=31536000_ \(å•ä½æ˜¯s 1å¹´\)
* Cache-Controlçš„å€¼:
  * **max-age** è®¾ç½®ç¼“å­˜çš„æœ€å¤§è¿‡æœŸæ—¶é—´
  * **no-cache** ä¸ç”¨å¼ºåˆ¶ç¼“å­˜ ç›´æ¥å»æ‰¾serverè¯·æ±‚
  * no-store ä¸ç”¨å¼ºåˆ¶ç¼“å­˜ ä¸ç”¨serverçš„ç¼“å­˜æªæ–½ ç›´æ¥è®©serverç®€å•ç²—æš´è¿”å›æ‰€æœ‰èµ„æº \(ä¸å¸¸è§\)
  * private åªå…è®¸æœ€ç»ˆç”¨æˆ·åšç¼“å­˜
  * public 
* **Expires** \(åœ¨ response headersä¸­\) åŒä¸ºæ§åˆ¶ç¼“å­˜è¿‡æœŸ _å·²è¢« Cache-Controlä»£æ›¿_

![&#x5F3A;&#x5236;&#x7F13;&#x5B58; - 1 - &#x6D4F;&#x89C8;&#x5668;&#x521D;&#x6B21;&#x8BF7;&#x6C42; &#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x8D44;&#x6E90;&#x5E76;&#x8BBE;&#x7F6E;cache-control](../../.gitbook/assets/cache1.png)

![&#x5F3A;&#x5236;&#x7F13;&#x5B58; - 2 - &#x6D4F;&#x89C8;&#x5668;&#x518D;&#x6B21;&#x8BF7;&#x6C42; &#x76F4;&#x63A5;&#x5728;&#x672C;&#x5730;&#x627E;&#x8D44;&#x6E90;](../../.gitbook/assets/cache2.png)

![&#x5F3A;&#x5236;&#x7F13;&#x5B58; - 3 - &#x5F53;&#x7F13;&#x5B58;&#x8FC7;&#x671F;&#x4E86; &#x6D4F;&#x89C8;&#x5668;&#x9700;&#x8981;&#x518D;&#x6B21;&#x5411;&#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x4E00;&#x904D;  &#x91CD;&#x65B0;&#x8BBE;&#x7F6E;cache-control](../../.gitbook/assets/cache3.png)

### åå•†ç¼“å­˜ \(å¯¹æ¯”ç¼“å­˜\)

{% hint style="info" %}
Last-Modified vs Etag
{% endhint %}

* **æœåŠ¡å™¨ç«¯**ç¼“å­˜ç­–ç•¥
* æœåŠ¡å™¨åˆ¤æ–­å®¢æˆ·ç«¯èµ„æº æ˜¯å¦å’ŒæœåŠ¡ç«¯èµ„æºä¸€æ ·
* ä¸€è‡´åˆ™è¿”å›**304** å¦åˆ™è¿”å›200å’Œæœ€æ–°èµ„æº

![&#x534F;&#x5546;&#x7F13;&#x5B58; - &#x8D44;&#x6E90;&#x6807;&#x8BC6;](../../.gitbook/assets/cache4.png)

**èµ„æºæ ‡è¯†** \(æ˜¯èµ„æºçš„ç¬¦å·\) 

* åœ¨response headers ä¸­
* æœ‰2ç§:
  * **Last-Modified** èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´
  * **Etag** èµ„æºçš„å”¯ä¸€æ ‡è¯† \(ä¸€ä¸ªå­—ç¬¦ä¸² ç±»ä¼¼äººçš„æŒ‡çº¹\)
* è¿™ä¸¤ä¸ªå¯å…±å­˜ ä¼˜å…ˆä½¿ç”¨ Etag
  * Last-Modifiedåªèƒ½ç²¾ç¡®åˆ°ç§’
  * å¦‚æœèµ„æºè¢«é‡å¤ç”Ÿæˆ è€Œå†…å®¹ä¸å˜ åˆ™Etagæ›´ç²¾ç¡®

![&#x534F;&#x5546;&#x7F13;&#x5B58; - Last-Modified &#x548C; If-Modified-Since&#x7684;&#x503C;&#x662F;&#x4E00;&#x6837;&#x7684; &#x90FD;&#x662F;&#x8D44;&#x6E90;&#x7684;&#x4E0A;&#x6B21;&#x4FEE;&#x6539;&#x65F6;&#x95F4;](../../.gitbook/assets/cache5.png)

![&#x534F;&#x5546;&#x7F13;&#x5B58; - Etag &#x548C; If-None-Match &#x7684;&#x503C;&#x4E00;&#x6837; &#x670D;&#x52A1;&#x5668;&#x62FF;&#x5230;If-None-Match&#x4E4B;&#x540E;&#x4E0E;Etag&#x8FDB;&#x884C;&#x5BF9;&#x6BD4;](../../.gitbook/assets/cache6.png)

![http &#x7F13;&#x5B58;&#x7B56;&#x7565; - &#x603B;&#x7ED3; \(&#x5F3A;&#x5236;&#x7F13;&#x5B58; &amp; &#x534F;&#x5546;&#x7F13;&#x5B58;\)](../../.gitbook/assets/cache7.png)

## åˆ·æ–°æ“ä½œæ–¹å¼ å¯¹ç¼“å­˜çš„å½±å“

* ä¸‰ç§åˆ·æ–°æ“ä½œ
  1. æ­£å¸¸æ“ä½œ: åœ°å€æ è¾“å…¥url è·³è½¬è¿æ¥ å‰è¿›åé€€ç­‰
  2. æ‰‹åŠ¨åˆ·æ–°: F5 ç‚¹å‡»åˆ·æ–°æŒ‰é’® å³å‡»èœå•åˆ·æ–° 
  3. å¼ºåˆ¶åˆ·æ–°ï¼šctrl + F5
* ä¸åŒåˆ·æ–°æ“ä½œ ä¸åŒçš„ç¼“å­˜ç­–ç•¥
  1. æ­£å¸¸æ“ä½œ: å¼ºåˆ¶ç¼“å­˜æœ‰æ•ˆ åå•†ç¼“å­˜æœ‰æ•ˆ
  2. æ‰‹åŠ¨åˆ·æ–°: å¼ºåˆ¶ç¼“å­˜å¤±æ•ˆ åå•†ç¼“å­˜æœ‰æ•ˆ
  3. å¼ºåˆ¶åˆ·æ–°ï¼šå¼ºåˆ¶ç¼“å­˜å¤±æ•ˆ åå•†ç¼“å­˜å¤±æ•ˆ

